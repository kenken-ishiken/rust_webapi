# TDD Workflow Configuration
# ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯TDDï¼ˆãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼‰ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®è¨­å®šã‚’å®šç¾©ã—ã¾ã™

metadata:
  name: "Rust WebAPI TDD Workflow"
  version: "1.0.0"
  description: "Test-Driven Development workflow configuration for Rust WebAPI project"
  last_updated: "2025-06-01"
  maintainer: "GitHub Copilot Agent"

# TDDã®åŸºæœ¬ã‚µã‚¤ã‚¯ãƒ«å®šç¾©
tdd_cycle:
  phases:
    red:
      name: "Red Phase"
      description: "å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã"
      emoji: "ğŸ”´"
      objectives:
        - "æ–°æ©Ÿèƒ½ã®è¦ä»¶ã‚’æ˜ç¢ºã«ã™ã‚‹"
        - "æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã‚’ãƒ†ã‚¹ãƒˆã§å®šç¾©ã™ã‚‹"
        - "ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹"
      success_criteria:
        - "ãƒ†ã‚¹ãƒˆãŒæœŸå¾…é€šã‚Šå¤±æ•—ã™ã‚‹"
        - "ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒè¦ä»¶ã‚’æ­£ç¢ºã«è¡¨ç¾ã—ã¦ã„ã‚‹"
        - "ãƒ†ã‚¹ãƒˆåãŒæ„å›³ã‚’æ˜ç¢ºã«ç¤ºã—ã¦ã„ã‚‹"
      
    green:
      name: "Green Phase"
      description: "æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆã‚’é€šã™"
      emoji: "ğŸŸ¢"
      objectives:
        - "ãƒ†ã‚¹ãƒˆã‚’é€šã™ãŸã‚ã®æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã™ã‚‹"
        - "ç¾ã—ã•ã‚ˆã‚Šå‹•ä½œã‚’å„ªå…ˆã™ã‚‹"
        - "ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹ã¾ã§å®Ÿè£…ã‚’ç¶™ç¶šã™ã‚‹"
      success_criteria:
        - "ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹"
        - "å®Ÿè£…ãŒæœ€å°é™ã§ã‚ã‚‹"
        - "æ–°ã—ã„ãƒ†ã‚¹ãƒˆã«ã‚ˆã£ã¦æ—¢å­˜æ©Ÿèƒ½ãŒå£Šã‚Œã¦ã„ãªã„"
      
    refactor:
      name: "Refactor Phase"
      description: "ãƒ†ã‚¹ãƒˆã‚’ä¿ã¡ãªãŒã‚‰ã‚³ãƒ¼ãƒ‰ã‚’æ”¹å–„ã™ã‚‹"
      emoji: "ğŸ”µ"
      objectives:
        - "ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ã‚’å‘ä¸Šã•ã›ã‚‹"
        - "é‡è¤‡ã‚’é™¤å»ã™ã‚‹"
        - "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€é©åŒ–ã™ã‚‹"
        - "è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é©ç”¨ã™ã‚‹"
      success_criteria:
        - "ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒå¼•ãç¶šãæˆåŠŸã™ã‚‹"
        - "ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ãŒå‘ä¸Šã—ã¦ã„ã‚‹"
        - "é‡è¤‡ãŒé™¤å»ã•ã‚Œã¦ã„ã‚‹"
        - "ã‚³ãƒ¼ãƒ‰å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒæ”¹å–„ã—ã¦ã„ã‚‹"

# ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥ãƒ†ã‚¹ãƒˆæˆ¦ç•¥
test_strategy:
  layers:
    domain:
      name: "Domain Layer"
      description: "ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«"
      test_types:
        - unit_tests
      test_patterns:
        - "Given-When-Then structure"
        - "Result type error handling"
        - "Value object validation"
        - "Domain rules enforcement"
      tools:
        - "cargo test --lib"
        - "assert_matches!"
        - "Custom error types"
      
    application:
      name: "Application Layer"
      description: "ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã¨ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹"
      test_types:
        - unit_tests
        - integration_tests
      test_patterns:
        - "Mock repositories"
        - "Service orchestration"
        - "Error propagation"
        - "Transaction boundaries"
      tools:
        - "mockall"
        - "tokio::test"
        - "Arc<dyn Repository>"
      
    infrastructure:
      name: "Infrastructure Layer"
      description: "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€å¤–éƒ¨APIã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ "
      test_types:
        - integration_tests
        - contract_tests
      test_patterns:
        - "Database transactions"
        - "Connection pooling"
        - "External service mocking"
        - "Configuration testing"
      tools:
        - "sqlx::test"
        - "testcontainers"
        - "wiremock"
      
    presentation:
      name: "Presentation Layer"
      description: "REST APIã€GraphQLã€WebSocket"
      test_types:
        - integration_tests
        - end_to_end_tests
      test_patterns:
        - "HTTP request/response testing"
        - "Authentication/authorization"
        - "Input validation"
        - "Error response format"
      tools:
        - "axum-test"
        - "reqwest"
        - "serde_json::json!"

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œè¨­å®š
test_execution:
  commands:
    unit_tests:
      command: "cargo test --lib"
      description: "ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå†…ã®å˜ä½“ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ"
      timeout: 60
      parallel: true
      
    integration_tests:
      command: "cargo test --test integration_test"
      description: "çµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ"
      timeout: 120
      parallel: false
      requires_database: true
      
    all_tests:
      command: "cargo test"
      description: "ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ"
      timeout: 180
      parallel: true
      
    coverage:
      command: "cargo tarpaulin --all-features --workspace --timeout 120"
      description: "ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç”Ÿæˆ"
      timeout: 300
      output_formats:
        - xml
        - html
        - lcov
      
    watch_tests:
      command: "cargo watch -x test"
      description: "ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ™‚ã«è‡ªå‹•ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ"
      continuous: true
      
    specific_test:
      command: "cargo test {test_name}"
      description: "ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ"
      parameters:
        - test_name

# ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
quality_checks:
  linting:
    clippy:
      command: "cargo clippy --all-targets --all-features -- -D warnings"
      description: "Rust linter"
      required: true
      
  formatting:
    rustfmt:
      command: "cargo fmt -- --check"
      description: "ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯"
      required: true
      
  security:
    audit:
      command: "cargo audit"
      description: "è„†å¼±æ€§ç›£æŸ»"
      required: true
      
  dependencies:
    outdated:
      command: "cargo outdated"
      description: "ä¾å­˜é–¢ä¿‚ã®æ›´æ–°ãƒã‚§ãƒƒã‚¯"
      required: false

# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
performance_tests:
  types:
    unit_performance:
      description: "å€‹åˆ¥é–¢æ•°ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ"
      threshold_ms: 100
      tools:
        - "std::time::Instant"
        - "criterion"
        
    load_testing:
      description: "APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è² è·ãƒ†ã‚¹ãƒˆ"
      tools:
        - "k6"
        - "artillery"
      scenarios:
        - name: "smoke_test"
          virtual_users: 1
          duration: "30s"
        - name: "load_test"
          virtual_users: 10
          duration: "2m"
        - name: "stress_test"
          virtual_users: 50
          duration: "5m"

# ç’°å¢ƒè¨­å®š
environments:
  test:
    database_url: "postgresql://postgres:password@localhost:5432/test_db"
    redis_url: "redis://localhost:6379/1"
    log_level: "debug"
    port: 3001
    
  ci:
    database_url: "postgresql://postgres:password@localhost:5432/test_db"
    log_level: "info"
    parallel_jobs: 4
    timeout_multiplier: 2

# ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
best_practices:
  test_naming:
    patterns:
      - "test_{action}_{condition}_{expected_result}"
      - "test_{feature}_{scenario}"
    examples:
      - "test_create_product_with_valid_data_should_succeed"
      - "test_create_product_with_empty_name_should_fail"
      
  test_structure:
    pattern: "Given-When-Then"
    sections:
      given:
        description: "ãƒ†ã‚¹ãƒˆã®å‰ææ¡ä»¶ã‚’è¨­å®š"
        keywords: ["Given", "Setup", "Arrange"]
      when:
        description: "ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®å‹•ä½œã‚’å®Ÿè¡Œ"
        keywords: ["When", "Act", "Execute"]
      then:
        description: "çµæœã‚’æ¤œè¨¼"
        keywords: ["Then", "Assert", "Verify"]
        
  error_handling:
    patterns:
      - "Result<T, E> for recoverable errors"
      - "panic! only for programming errors"
      - "Custom error types with thiserror"
      - "assert_matches! for error pattern matching"
      
  mock_usage:
    guidelines:
      - "Use mocks for external dependencies"
      - "Avoid mocking value objects"
      - "Mock at the boundary of your system"
      - "Keep mocks simple and focused"

# GitHub Copilot Agentå‘ã‘ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
copilot_prompts:
  generate_test:
    template: |
      /generate test for {function_or_class} following TDD workflow
      - Include positive and negative test cases
      - Follow the project's error handling patterns
      - Use Given-When-Then structure
      - Use assert_matches! for error cases
      
  implement_code:
    template: |
      /implement the minimum code to make these tests pass:
      {test_code}
      
      Follow the project's coding standards and error handling patterns.
      
  refactor_code:
    template: |
      /refactor this code while keeping all tests passing:
      {code}
      
      Improve readability, remove duplication, and enhance performance.

# è‡ªå‹•åŒ–è¨­å®š
automation:
  pre_commit_hooks:
    - name: "format_check"
      command: "cargo fmt -- --check"
    - name: "clippy_check"
      command: "cargo clippy -- -D warnings"
    - name: "test_run"
      command: "cargo test --all"
      
  continuous_integration:
    triggers:
      - "push to main/develop branches"
      - "pull request to main/develop"
      - "manual workflow dispatch"
    steps:
      - "setup_environment"
      - "install_dependencies"
      - "run_tests"
      - "quality_checks"
      - "generate_reports"
      
  notifications:
    success:
      message: "âœ… TDD workflow completed successfully!"
    failure:
      message: "âŒ TDD workflow failed. Check logs for details."
      actions:
        - "Review test failures"
        - "Check code quality issues"
        - "Verify environment setup"

# ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†
metrics:
  test_metrics:
    - "test_count"
    - "test_duration"
    - "test_success_rate"
    - "coverage_percentage"
    
  code_metrics:
    - "lines_of_code"
    - "cyclomatic_complexity"
    - "technical_debt_ratio"
    - "duplication_percentage"
    
  performance_metrics:
    - "build_time"
    - "test_execution_time"
    - "memory_usage"
    - "cpu_usage"

# å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹
learning_resources:
  books:
    - "Test-Driven Development by Kent Beck"
    - "Growing Object-Oriented Software, Guided by Tests"
    - "The Rust Programming Language (Testing chapter)"
    
  online_resources:
    - "Rust Testing Guide: https://doc.rust-lang.org/book/ch11-00-testing.html"
    - "TDD with Rust: https://rust-lang-nursery.github.io/edition-guide/"
    - "Rust Testing Best Practices"
    
  tools_documentation:
    - "cargo test: https://doc.rust-lang.org/cargo/commands/cargo-test.html"
    - "mockall: https://docs.rs/mockall/"
    - "tarpaulin: https://github.com/xd009642/tarpaulin"
